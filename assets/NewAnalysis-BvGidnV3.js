import{r as o,j as e,c as D}from"./index-DTwl35de.js";import{c as M}from"./analysesStorage-DB-LTlel.js";import{c as R}from"./mockCustomers-DLB6nk5I.js";const B=l=>new Promise((t,i)=>{const n=new FileReader;n.readAsDataURL(l),n.onload=()=>t(n.result),n.onerror=u=>i(u)}),L=({value:l,onChange:t,accept:i="image/*",capture:n=!0})=>{const u=o.useRef(),m=async r=>{if(!r)return;const g=await B(r);t(g)};return e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-32 h-32 bg-gray-100 rounded-md overflow-hidden flex items-center justify-center",children:l?e.jsx("img",{src:l,alt:"preview",className:"w-full h-full object-cover"}):e.jsx("div",{className:"text-sm text-gray-500",children:"No image"})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"px-3 py-2 bg-white border rounded cursor-pointer inline-block",children:[e.jsx("input",{ref:u,type:"file",accept:i,capture:n?"environment":void 0,onChange:r=>r.target.files&&m(r.target.files[0]),className:"hidden"}),n?"Capture / Upload":"Upload image"]}),l&&e.jsx("button",{onClick:()=>t(null),className:"px-3 py-2 border rounded text-sm",children:"Remove"})]})]})})},h=[{key:"hairImageChoice",type:"images",title:"Which image best describes your hair loss?",options:[{id:"thinning",label:"Diffuse thinning"},{id:"bald_patches",label:"Bald patches / localized"},{id:"receding",label:"Receding hairline"},{id:"mild_thin",label:"Mild overall thinning"}]},{key:"familyHistory",type:"radio",title:"Family history of hair loss?",options:["No","Yes paternal side","Yes maternal side","Both"]},{key:"dandruff",type:"radio",title:"Do you have dandruff?",options:["No","Mild","Heavy","Health condition"]},{key:"sleep",type:"radio",title:"How well do you sleep?",options:["Sound 8 hours","Disturbed sleep","Insomnia"]},{key:"stress",type:"range",title:"How stressed are you (1–10)?",min:1,max:10},{key:"gastric",type:"conditional",title:"Do you have any gastric problem?",options:["No","Yes"],followUpKey:"gastricDetails",followUpPlaceholder:"Describe gastric issue"},{key:"energy",type:"range",title:"Energy level during day (1–10)",min:1,max:10},{key:"medication",type:"conditional",title:"Are you on any medication?",options:["No","Yes"],followUpKey:"medicationDetails",followUpPlaceholder:"List medications"},{key:"scalpImage",type:"image-upload",title:"Upload / take a scalp picture",note:"A clear top-down image helps experts"}],P=(l="")=>{if(!l)return[];const t=l.toLowerCase();return R.filter(i=>[i.id,i.name,i.email,i.phone].join(" ").toLowerCase().includes(t))},Y=()=>{const l=D(),[t,i]=o.useState(""),[n,u]=o.useState([]),[m,r]=o.useState(null),[g,y]=o.useState(!1),[d,b]=o.useState(0),[c,C]=o.useState({}),[j,S]=o.useState(null),[A,w]=o.useState(!1),k=s=>{i(s),u(P(s))},U=s=>{r(s),y(!0)},x=(s,f)=>C(v=>({...v,[s]:f})),p=()=>b(s=>Math.min(h.length-1,s+1)),N=()=>b(s=>Math.max(0,s-1)),I=async()=>{w(!0),await new Promise(v=>setTimeout(v,3e3));const s={customerId:m?.id||null,customerSnapshot:m||{name:t||"Guest"},answers:{...c},scalpImageBase64:j},f=M(s);w(!1),l(`/analysis/report/${f.testId}`)},a=h[d];return e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"New Analysis"}),!g&&e.jsxs("div",{className:"bg-white rounded-lg p-4 border mb-6",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Search Customer"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"flex-1 p-2 border rounded",placeholder:"Search by name, email or phone",value:t,onChange:s=>k(s.target.value)}),e.jsx("button",{onClick:()=>k(t),className:"px-3 py-2 border rounded",children:"Search"})]}),e.jsx("div",{children:n.length?n.map(s=>e.jsxs("div",{className:"p-2 border rounded flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.name," ",e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:s.id})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.email," • ",s.phone||"No phone"]})]}),e.jsx("button",{onClick:()=>U(s),className:"px-3 py-2 bg-blue-600 text-white rounded",children:"Select"})]},s.id)):e.jsx("div",{className:"text-sm text-gray-500",children:"No matches yet"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm mb-2",children:"Or proceed without selecting a customer:"}),e.jsxs("button",{onClick:()=>{r({id:null,name:t||"Guest"}),y(!0)},className:"px-4 py-2 border rounded",children:["Proceed as ",t||"Guest"]})]})]}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg p-4 border mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:m?.name||"Guest"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[m?.email||"No email"," • ",m?.phone||"No phone"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{y(!1),r(null)},className:"px-3 py-2 border rounded",children:"Change"}),e.jsx("button",{onClick:()=>{},className:"px-3 py-2 bg-green-600 text-white rounded",children:"Start Analysis"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.title}),a.note&&e.jsx("div",{className:"text-xs text-gray-500",children:a.note})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[d+1,"/",h.length]})]}),e.jsxs("div",{className:"mb-6",children:[a.type==="images"&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:a.options.map(s=>e.jsxs("button",{onClick:()=>{x(a.key,s.label),p()},className:`p-3 border rounded text-left ${c[a.key]===s.label?"ring-2 ring-blue-500":""}`,children:[e.jsx("div",{className:"h-24 bg-gray-100 rounded mb-2 flex items-center justify-center text-sm",children:s.label}),e.jsx("div",{className:"text-sm",children:s.label})]},s.id))}),a.type==="radio"&&e.jsxs("div",{className:"space-y-2",children:[a.options.map(s=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:a.key,checked:c[a.key]===s,onChange:()=>x(a.key,s)}),e.jsx("span",{children:s})]},s)),e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:p,className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Next"})})]}),a.type==="range"&&e.jsxs("div",{children:[e.jsx("input",{type:"range",min:a.min,max:a.max,value:c[a.key]??Math.floor((a.min+a.max)/2),onChange:s=>x(a.key,Number(s.target.value))}),e.jsxs("div",{className:"mt-2",children:["Value: ",e.jsx("strong",{children:c[a.key]??Math.floor((a.min+a.max)/2)})]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[d>0&&e.jsx("button",{onClick:N,className:"px-3 py-2 border rounded",children:"Back"}),e.jsx("button",{onClick:p,className:"px-3 py-2 bg-blue-600 text-white rounded",children:"Next"})]})]}),a.type==="conditional"&&e.jsxs("div",{children:[a.options.map(s=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:a.key,checked:c[a.key]===s,onChange:()=>x(a.key,s)}),e.jsx("span",{children:s})]},s)),c[a.key]==="Yes"&&e.jsx("div",{className:"mt-2",children:e.jsx("textarea",{placeholder:a.followUpPlaceholder,value:c[a.followUpKey]||"",onChange:s=>x(a.followUpKey,s.target.value),className:"w-full p-2 border rounded"})}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[d>0&&e.jsx("button",{onClick:N,className:"px-3 py-2 border rounded",children:"Back"}),e.jsx("button",{onClick:p,className:"px-3 py-2 bg-blue-600 text-white rounded",children:"Next"})]})]}),a.type==="image-upload"&&e.jsxs("div",{children:[e.jsx(L,{value:j,onChange:S}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[d>0&&e.jsx("button",{onClick:N,className:"px-3 py-2 border rounded",children:"Back"}),e.jsx("button",{onClick:()=>{x(a.key,j),p()},className:"px-3 py-2 bg-blue-600 text-white rounded",children:"Next"})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{style:{width:`${Math.round(d/h.length*100)}%`},className:"h-full bg-blue-600"})}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[d," completed • ",h.length-d," remaining"]})]}),d===h.length-1&&e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>b(0),className:"px-3 py-2 border rounded",children:"Review"}),e.jsx("button",{onClick:I,className:"px-4 py-2 bg-green-600 text-white rounded",children:"Submit Analysis"})]})]})]}),A&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40"}),e.jsxs("div",{className:"bg-white p-6 rounded shadow z-10 w-[520px] text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Analyzing image — AI processing"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"We are running the analysis. This takes a few seconds."}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-600 animate-progress",style:{width:"85%"}})}),e.jsx("style",{children:`
              @keyframes progress {
                0% { width: 0% }
                50% { width: 60% }
                100% { width: 100% }
              }
              .animate-progress { animation: progress 3s linear forwards; }
            `})]})]})]})};export{Y as default};
