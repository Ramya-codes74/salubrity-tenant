import{a as w,c as C,b as S,r as m,j as e}from"./index-CaIbOwnm.js";const E=({mode:j="create"})=>{const{role:x}=w(),i=C(),{modules:c,createRole:v,updateRole:f,getRole:N,getRolesList:y}=S(),d=x?decodeURIComponent(x):null,a=j==="edit",[l,u]=m.useState(""),[h,p]=m.useState(""),[b,o]=m.useState({});m.useEffect(()=>{if(a&&d){const s=N(d);if(!s){alert("Role not found"),i("/roles");return}if(s.system){alert("System roles cannot be edited"),i("/roles");return}u(d),p(s.description||""),o(s.permissions||{})}else{const s={};Object.keys(c).forEach(t=>{s[t]=[]}),o(s)}},[a,d]);const k=(s,t)=>{o(n=>{const r=new Set(n[s]||[]);return r.has(t)?r.delete(t):r.add(t),{...n,[s]:Array.from(r)}})},g=(s,t)=>{o(n=>({...n,[s]:t?[...c[s]]:[]}))},R=()=>{if(!l||l.trim()==="")return alert("Role name required");if(l==="Super Admin")return alert("Cannot create or modify Super Admin");const s={description:h,permissions:b};try{if(a)f(l,s);else{if(y().includes(l))return alert("Role already exists");v(l,s)}i("/roles")}catch(t){console.error(t),alert(t.message||"Failed to save role")}};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:a?`Edit Role: ${l}`:"Create Role"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>i("/roles"),className:"px-4 py-2 border rounded-lg",children:"Back"}),e.jsx("button",{onClick:R,className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:"Save Role"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg p-4 border",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Permissions *"}),e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Choose module actions"})]}),e.jsx("div",{className:"space-y-4",children:Object.keys(c).map(s=>{const t=c[s]||[],n=new Set(b[s]||[]);return e.jsxs("div",{className:"border rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium",children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>g(s,!0),className:"text-sm px-2 py-1 border rounded",children:"All"}),e.jsx("button",{type:"button",onClick:()=>g(s,!1),className:"text-sm px-2 py-1 border rounded",children:"None"})]})]}),e.jsx("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-4 gap-2",children:t.map(r=>e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:n.has(r),onChange:()=>k(s,r)}),e.jsx("span",{className:"capitalize",children:r})]},r))})]},s)})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"font-semibold",children:"General"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Name & description"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name *"}),e.jsx("input",{value:l,onChange:s=>u(s.target.value),className:"w-full p-2 border rounded-lg",disabled:a}),a&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Role name cannot be changed. Use create to make a new role."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{value:h,onChange:s=>p(s.target.value),className:"w-full p-2 border rounded-lg",rows:4})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Permission preview"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Selected permissions are saved per module. Super Admin is a system role and cannot be created or edited."})]})]})]})]})]})};export{E as default};
