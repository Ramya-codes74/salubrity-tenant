const r="analyses_v1",g=()=>{localStorage.getItem(r)||localStorage.setItem(r,JSON.stringify([]))},l=()=>{try{return g(),JSON.parse(localStorage.getItem(r))||[]}catch(t){return console.error(t),[]}},c=t=>{try{localStorage.setItem(r,JSON.stringify(t))}catch(s){console.error(s)}},I=(t=[])=>{const s=t.map(e=>parseInt((e.testId||"").replace(/^T0*/,"")||0,10)),n=(s.length?Math.max(...s):0)+1;return`T${String(n).padStart(4,"0")}`},S=({customerId:t,customerSnapshot:s,answers:a,scalpImageBase64:n})=>{const e=l(),u=I(e),d={testId:u,customerId:t||null,customerSnapshot:s||null,answers:a,scalpImageBase64:n||null,status:"Pending",report:null,clinicianNotes:"",createdAt:new Date().toISOString()};return e.unshift(d),c(e),setTimeout(()=>{const i=l().map(o=>{if(o.testId!==u)return o;const{generateReport:m}=require("../utils/reportGenerator"),p=m(o);return{...o,status:"Complete",report:p,completedAt:new Date().toISOString()}});c(i)},2e3),d},f=t=>l().find(a=>a.testId===t)||null,y=(t,s)=>{const n=l().map(e=>e.testId===t?{...e,...s}:e);return c(n),n.find(e=>e.testId===t)||null};export{S as c,f,l,y as u};
