import{c as E,r as l,j as e}from"./index-CaIbOwnm.js";import{l as b}from"./analysesStorage-DB-LTlel.js";import{S as C}from"./SlidePanel-CqrNY1eA.js";const A=[5,10,20],I=()=>{const g=E(),[p,h]=l.useState([]),[c,v]=l.useState(""),[S,x]=l.useState(!1),[i,u]=l.useState(""),[a,j]=l.useState(""),[o,w]=l.useState(10),[r,d]=l.useState(1);l.useEffect(()=>{h(b())},[]),l.useEffect(()=>{const s=t=>{t.key&&t.key.startsWith("analyses")&&h(b())};return window.addEventListener("storage",s),()=>window.removeEventListener("storage",s)},[]);const y=l.useMemo(()=>{let s=p.slice();if(c){const t=c.toLowerCase();s=s.filter(n=>[n.testId,n.customerSnapshot?.name,n.customerSnapshot?.email].join(" ").toLowerCase().includes(t))}return i&&(s=s.filter(t=>t.status===i)),a&&(a==="Self"&&(s=s.filter(t=>!t.createdByEmployee)),a==="Employee"&&(s=s.filter(t=>!!t.createdByEmployee))),s.sort((t,n)=>new Date(n.createdAt)-new Date(t.createdAt)),s},[p,c,i,a]),f=y.length,m=Math.max(1,Math.ceil(f/o)),N=y.slice((r-1)*o,r*o);return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Analysis History"}),e.jsx("p",{className:"text-sm text-gray-500",children:"All analyses performed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x(!0),className:"px-3 py-2 border rounded",children:"Filters"}),e.jsx("select",{value:o,onChange:s=>{w(Number(s.target.value)),d(1)},className:"px-3 py-2 border rounded",children:A.map(s=>e.jsxs("option",{value:s,children:[s," / page"]},s))})]})]}),e.jsxs("div",{className:"bg-white rounded border",children:[e.jsx("div",{className:"p-4 border-b flex items-center gap-3",children:e.jsx("input",{placeholder:"Search by test id, customer or email",value:c,onChange:s=>{v(s.target.value),d(1)},className:"flex-1 p-2 border rounded"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Test"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Date / Time"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Performed by"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"})]})}),e.jsx("tbody",{children:N.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>g(`/analysis/report/${s.testId}`),children:[e.jsx("td",{className:"px-4 py-3",children:s.testId}),e.jsxs("td",{className:"px-4 py-3",children:[s.customerSnapshot?.name||"Guest",e.jsx("div",{className:"text-xs text-gray-500",children:s.customerSnapshot?.email})]}),e.jsx("td",{className:"px-4 py-3",children:new Date(s.createdAt).toLocaleString()}),e.jsx("td",{className:"px-4 py-3",children:s.createdByEmployee?`${s.createdByEmployeeName||"Employee"}`:"Self"}),e.jsx("td",{className:"px-4 py-3",children:s.status})]},s.testId))})]})}),e.jsxs("div",{className:"p-4 border-t flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",e.jsx("strong",{children:N.length})," of ",e.jsx("strong",{children:f})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:r===1,onClick:()=>d(s=>Math.max(1,s-1)),className:"px-3 py-2 border rounded",children:"Prev"}),e.jsxs("div",{className:"px-3 py-2 border rounded text-sm",children:["Page ",r," of ",m]}),e.jsx("button",{disabled:r===m,onClick:()=>d(s=>Math.min(m,s+1)),className:"px-3 py-2 border rounded",children:"Next"})]})]})]}),e.jsx(C,{open:S,onClose:()=>x(!1),children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Filters"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Status"}),e.jsxs("select",{value:i,onChange:s=>u(s.target.value),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"",children:"Any"}),e.jsx("option",{children:"Pending"}),e.jsx("option",{children:"Complete"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Performed by"}),e.jsxs("select",{value:a,onChange:s=>j(s.target.value),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"",children:"Any"}),e.jsx("option",{value:"Self",children:"Self"}),e.jsx("option",{value:"Employee",children:"Employee"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{u(""),j("")},className:"px-4 py-2 border rounded",children:"Reset"}),e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Apply"})]})]})]})})]})};export{I as default};
