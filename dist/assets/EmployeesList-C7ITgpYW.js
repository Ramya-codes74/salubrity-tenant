import{j as e,c as O,e as q,r as l,L as k}from"./index-CaIbOwnm.js";import{l as B,s as Z}from"./employeesStorage-TR-DAmyG.js";import{S as _}from"./SlidePanel-CqrNY1eA.js";import{E as G}from"./EmailPreviewModal-bNP54EsI.js";import{F as V,P as K,S as Q,E as W,a as Y,T as H}from"./trash-2-BCCqXC6D.js";const J=({title:b="Confirm",body:d,onCancel:i,onConfirm:o})=>e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:i}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 z-10 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:b}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:d}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:i,className:"px-3 py-2 border rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:o,className:"px-3 py-2 bg-red-600 text-white rounded-lg",children:"Confirm"})]})]})]}),U=[5,10,20],ae=()=>{const b=O(),d=q(),[i,o]=l.useState([]),[p,T]=l.useState(""),[f,C]=l.useState(""),[g,A]=l.useState(""),[y,$]=l.useState(10),[n,x]=l.useState(1),[R,N]=l.useState(!1),[h,v]=l.useState(null),[j,P]=l.useState(null),[c,F]=l.useState({field:"createdAt",dir:"desc"}),u=l.useCallback(()=>{try{const s=B();Array.isArray(s)?o(s):(console.warn("[EmployeeList] loadEmployees did not return an array, resetting to []"),o([]))}catch(s){console.error("[EmployeeList] failed to load employees:",s),o([])}},[]);l.useEffect(()=>{u()},[u]),l.useEffect(()=>{const s=a=>{a.key&&a.key.startsWith("employees")&&u()};return window.addEventListener("storage",s),()=>window.removeEventListener("storage",s)},[u]),l.useEffect(()=>{d?.state?.emailPreview&&(u(),P(d.state.emailPreview),b(d.pathname,{replace:!0,state:{}}))},[d?.state?.emailPreview]);const w=s=>{Z(s),o(s)},D=l.useMemo(()=>Array.from(new Set(i.map(s=>s.role).filter(Boolean))),[i]),L=l.useMemo(()=>{let s=i.slice();if(p){const a=p.toLowerCase();s=s.filter(t=>[t.id,t.firstName,t.lastName,`${t.firstName} ${t.lastName}`,t.email,t.phone,t.role].join(" ").toLowerCase().includes(a))}return f&&(s=s.filter(a=>a.status===f)),g&&(s=s.filter(a=>a.role===g)),s.sort((a,t)=>{const r=a[c.field]||"",E=t[c.field]||"";return r===E?0:c.dir==="asc"?r>E?1:-1:r<E?1:-1}),s},[i,p,f,g,c]),M=L.length,m=Math.max(1,Math.ceil(M/y));l.useEffect(()=>{n>m&&x(m)},[m,n]);const S=L.slice((n-1)*y,n*y),I=s=>{v({type:"delete",payload:s,title:"Delete employee?",body:"This will permanently delete the employee record."})},z=()=>{if(!h)return;const{type:s,payload:a}=h;if(s==="delete"){const t=i.filter(r=>r.id!==a);w(t)}else if(s==="toggle"){const t=i.map(r=>r.id===a.id?{...r,status:a.newStatus}:r);w(t)}else if(s==="terminate"){const t=i.map(r=>r.id===a?{...r,status:"Terminated"}:r);w(t)}v(null)};return l.useEffect(()=>{i.length===0&&console.debug("[EmployeeList] employees array is empty. Check localStorage key and employeesStorage.STORAGE_KEY")},[i]),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Employees"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage employees, roles & access."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>N(!0),className:"px-3 py-2 border rounded-lg flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"})," Filters"]}),e.jsxs(k,{to:"/employees/add",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg",children:[e.jsx(K,{className:"w-4 h-4"})," Add Employee"]})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 mb-6 border",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{placeholder:"Search employees by name, id, email...",value:p,onChange:s=>{T(s.target.value),x(1)},className:"w-full pl-10 pr-4 py-2.5 border rounded-lg"})]}),e.jsx("select",{value:y,onChange:s=>{$(Number(s.target.value)),x(1)},className:"px-3 py-2 border rounded-lg",children:U.map(s=>e.jsxs("option",{value:s,children:[s," / page"]},s))})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-[900px]",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:"Employee"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Employee ID"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[S.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden flex items-center justify-center",children:s.avatar?e.jsx("img",{src:s.avatar,alt:"avatar",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-sm font-semibold",children:(s.firstName?.[0]??"")+(s.lastName?.[0]??"")})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsx("div",{className:"text-xs text-gray-500",children:s.phone})]})]})}),e.jsx("td",{className:"px-6 py-4",children:s.id}),e.jsx("td",{className:"px-6 py-4",children:s.email}),e.jsx("td",{className:"px-6 py-4",children:s.role}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-3 py-1 text-xs font-semibold rounded-full ${s.status==="Active"?"bg-green-100 text-green-800":s.status==="Deactivated"?"bg-yellow-100 text-yellow-800":s.status==="Terminated"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:s.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{to:`/employees/view/${s.id}`,className:"p-2 hover:bg-gray-100 rounded-md",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx(k,{to:`/employees/edit/${s.id}`,className:"p-2 hover:bg-gray-100 rounded-md",children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>I(s.id),className:"p-2 hover:bg-gray-100 rounded-md",children:e.jsx(H,{className:"w-4 h-4"})})]})})]},s.id)),S.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:"No employees found."})})]})]})}),e.jsxs("div",{className:"px-6 py-4 border-t flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",e.jsx("strong",{children:S.length})," of ",e.jsx("strong",{children:M})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:n===1,onClick:()=>x(s=>Math.max(1,s-1)),className:"px-3 py-2 border rounded-lg text-sm",children:"Prev"}),e.jsxs("div",{className:"px-3 py-2 border rounded-lg text-sm",children:["Page ",n," / ",m]}),e.jsx("button",{disabled:n===m,onClick:()=>x(s=>Math.min(m,s+1)),className:"px-3 py-2 border rounded-lg text-sm",children:"Next"})]})]})]}),h&&e.jsx(J,{title:h.title,body:h.body,onCancel:()=>v(null),onConfirm:z}),e.jsx(_,{open:R,onClose:()=>N(!1),children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Filters"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsxs("select",{value:f,onChange:s=>C(s.target.value),className:"w-full p-2 border rounded-lg",children:[e.jsx("option",{value:"",children:"Any"}),e.jsx("option",{children:"Active"}),e.jsx("option",{children:"Deactivated"}),e.jsx("option",{children:"Terminated"}),e.jsx("option",{children:"Invitation Sent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Role"}),e.jsxs("select",{value:g,onChange:s=>A(s.target.value),className:"w-full p-2 border rounded-lg",children:[e.jsx("option",{value:"",children:"Any"}),D.map(s=>e.jsx("option",{children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Sort by"}),e.jsxs("select",{value:`${c.field}:${c.dir}`,onChange:s=>{const[a,t]=s.target.value.split(":");F({field:a,dir:t})},className:"w-full p-2 border rounded-lg",children:[e.jsx("option",{value:"createdAt:desc",children:"Newest"}),e.jsx("option",{value:"createdAt:asc",children:"Oldest"}),e.jsx("option",{value:"firstName:asc",children:"First name (A → Z)"}),e.jsx("option",{value:"firstName:desc",children:"First name (Z → A)"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{C(""),A(""),F({field:"createdAt",dir:"desc"})},className:"px-4 py-2 border rounded-lg",children:"Reset"}),e.jsx("button",{onClick:()=>N(!1),className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:"Apply"})]})]})]})}),j&&e.jsx(G,{to:j.email,name:j.name,password:j.password,onClose:()=>P(null)})]})};export{ae as default};
